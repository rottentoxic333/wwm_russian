<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WWM ‚Äì —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="bg-white text-gray-900">
<div class="min-h-screen flex flex-col">
    <header class="border-b border-gray-200 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <div>
                <h1 class="text-xl font-semibold text-gray-900">Where Winds Meet ‚Äì —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤</h1>
                <p class="text-xs text-gray-500 mt-1">
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º <span class="font-mono">translation_ru.tsv</span> –∏ <span class="font-mono">_cn_translate/translation_ru.tsv</span>
                </p>
            </div>
            <button id="btnRefresh" class="inline-flex items-center rounded border border-gray-800 bg-gray-800 px-3 py-1.5 text-xs font-medium text-gray-50 hover:bg-gray-700">
                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </header>

    <main class="flex-1 max-w-6xl mx-auto w-full px-4 py-4 space-y-4">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ -->
        <section class="border border-gray-200 rounded-lg p-4 bg-white">
            <h2 class="text-sm font-semibold text-gray-800 mb-3">–û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ (translation_ru.tsv)</h2>
            <div id="mainStats" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center p-3 bg-gray-50 rounded">
                    <div class="text-2xl font-bold text-gray-900" id="mainTotal">-</div>
                    <div class="text-xs text-gray-600 mt-1">–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫</div>
                </div>
                <div class="text-center p-3 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-700" id="mainRU">-</div>
                    <div class="text-xs text-blue-600 mt-1">–†—É—Å—Å–∫–∏–π (RU)</div>
                    <div class="text-xs text-blue-500 mt-1" id="mainRUPercent">-</div>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded">
                    <div class="text-2xl font-bold text-yellow-700" id="mainEN">-</div>
                    <div class="text-xs text-yellow-600 mt-1">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (EN)</div>
                    <div class="text-xs text-yellow-500 mt-1" id="mainENPercent">-</div>
                </div>
                <div class="text-center p-3 bg-gray-50 rounded">
                    <div class="text-2xl font-bold text-gray-900" id="mainEmpty">-</div>
                    <div class="text-xs text-gray-600 mt-1">–ü—É—Å—Ç—ã–µ</div>
                </div>
            </div>
        </section>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—à–∏–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞ -->
        <section class="border border-gray-200 rounded-lg p-4 bg-white">
            <h2 class="text-sm font-semibold text-gray-800 mb-3">–ü—Ä–µ–¥–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</h2>
            <div id="cnStats" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center p-3 bg-gray-50 rounded">
                    <div class="text-2xl font-bold text-gray-900" id="cnTotal">-</div>
                    <div class="text-xs text-gray-600 mt-1">–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫</div>
                </div>
                <div class="text-center p-3 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-700" id="cnRU">-</div>
                    <div class="text-xs text-blue-600 mt-1">–†—É—Å—Å–∫–∏–π (RU)</div>
                    <div class="text-xs text-blue-500 mt-1" id="cnRUPercent">-</div>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded">
                    <div class="text-2xl font-bold text-yellow-700" id="cnEN">-</div>
                    <div class="text-xs text-yellow-600 mt-1">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (EN)</div>
                    <div class="text-xs text-yellow-500 mt-1" id="cnENPercent">-</div>
                </div>
                <div class="text-center p-3 bg-gray-50 rounded">
                    <div class="text-2xl font-bold text-gray-900" id="cnEmpty">-</div>
                    <div class="text-xs text-gray-600 mt-1">–ü—É—Å—Ç—ã–µ</div>
                </div>
            </div>
        </section>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–∞—à–∏–Ω–Ω–æ–º—É RU -->
        <section class="border border-gray-200 rounded-lg p-4 bg-white">
            <h2 class="text-sm font-semibold text-gray-800 mb-3">–ú–∞—à–∏–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –≤ —Ä—É—Å—Å–∫–æ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ</h2>
            <p class="text-xs text-gray-600 mb-3">
                –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–µ—Ä–µ–≤–æ–¥–µ –∏ –º–∞—à–∏–Ω–Ω–æ–º –ø–µ—Ä–µ–≤–æ–¥–µ.
            </p>
            <div id="uniqueStats" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="text-center p-3 bg-green-50 rounded">
                    <div class="text-2xl font-bold text-green-700" id="uniqueTotal">-</div>
                    <div class="text-xs text-green-600 mt-1">–ú–∞—à–∏–Ω–Ω—ã–π RU —Å–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ–≥–æ</div>
                </div>
                <div class="text-center p-3 bg-blue-50 rounded">
                    <div class="text-2xl font-bold text-blue-700" id="uniqueRU">-</div>
                    <div class="text-xs text-blue-600 mt-1">–ú–∞—à–∏–Ω–Ω—ã–π RU (–≤—Å–µ–≥–æ)</div>
                    <div class="text-xs text-blue-500 mt-1" id="uniqueRUPercent">-</div>
                </div>
                <div class="text-center p-3 bg-yellow-50 rounded">
                    <div class="text-2xl font-bold text-yellow-700" id="uniqueEN">-</div>
                    <div class="text-xs text-yellow-600 mt-1">–û—Å–Ω–æ–≤–Ω–æ–π RU (–≤—Å–µ–≥–æ)</div>
                    <div class="text-xs text-yellow-500 mt-1" id="uniqueENPercent">-</div>
                </div>
                <div class="text-center p-3 bg-gray-50 rounded">
                    <div class="text-2xl font-bold text-gray-900" id="uniqueEmpty">-</div>
                    <div class="text-xs text-gray-600 mt-1">–ú–∞—à–∏–Ω–Ω—ã–π RU / –æ—Å–Ω–æ–≤–Ω–æ–π RU</div>
                </div>
            </div>
        </section>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã -->
        <section class="border border-gray-200 rounded-lg p-4 bg-white">
            <h2 class="text-sm font-semibold text-gray-800 mb-3">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</h2>
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                        <span>–û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ - –†—É—Å—Å–∫–∏–π</span>
                        <span id="mainRUPercentBar">-</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="mainRUProgress" class="bg-blue-600 h-3 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                        <span>–ú–∞—à–∏–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ - –†—É—Å—Å–∫–∏–π</span>
                        <span id="cnRUPercentBar">-</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="cnRUProgress" class="bg-blue-600 h-3 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-xs text-gray-600 mb-1">
                        <span>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ - –†—É—Å—Å–∫–∏–π</span>
                        <span id="uniqueRUPercentBar">-</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="uniqueRUProgress" class="bg-green-600 h-3 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ -->
        <section class="border border-gray-200 rounded-lg p-3 bg-gray-50">
            <div id="loadingInfo" class="text-xs text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </section>
    </main>
</div>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç —Ä—É—Å—Å–∫–∏–º
    function isRussian(text) {
        if (!text || text.trim().length === 0) return false;
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä—É—Å—Å–∫–∏—Ö –±—É–∫–≤
        const russianPattern = /[–ê-–Ø–∞-—è–Å—ë]/;
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ—Å—Ç–æ–∏—Ç –ª–∏ —Å—Ç—Ä–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∏–∑ —Ü–∏—Ñ—Ä
        const onlyDigits = /^\d+$/.test(text.trim());
        return russianPattern.test(text) || onlyDigits;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ TSV —Ñ–∞–π–ª–∞
    // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∞ { id, text }
    function parseTSV(text) {
        const lines = text.split(/\r?\n/).filter(l => l.length > 0);
        if (lines.length === 0) return [];

        const header = lines[0].split('\t');
        const idIndex = header.indexOf('ID');
        const textIndex = header.indexOf('OriginalText');
        const idCol = idIndex >= 0 ? idIndex : 0;
        const txtCol = textIndex >= 0 ? textIndex : 1;

        const rows = [];
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split('\t');
            if (parts.length <= Math.max(idCol, txtCol)) continue;
            const id = (parts[idCol] || '').trim();
            if (!id) continue;
            const txt = parts[txtCol] || '';
            rows.push({ id, text: txt });
        }
        return rows;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function calculateStats(rows) {
        let total = rows.length;
        let ru = 0;
        let en = 0;
        let empty = 0;

        for (const row of rows) {
            const text = row.text || '';
            if (text.trim().length === 0) {
                empty++;
            } else if (isRussian(text)) {
                ru++;
            } else {
                en++;
            }
        }

        const ruPercent = total > 0 ? ((ru / total) * 100).toFixed(1) : 0;
        const enPercent = total > 0 ? ((en / total) * 100).toFixed(1) : 0;

        return { total, ru, en, empty, ruPercent, enPercent };
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    function updateStats(elementPrefix, stats) {
        document.getElementById(`${elementPrefix}Total`).textContent = stats.total.toLocaleString();
        document.getElementById(`${elementPrefix}RU`).textContent = stats.ru.toLocaleString();
        document.getElementById(`${elementPrefix}EN`).textContent = stats.en.toLocaleString();
        document.getElementById(`${elementPrefix}Empty`).textContent = stats.empty.toLocaleString();
        document.getElementById(`${elementPrefix}RUPercent`).textContent = `${stats.ruPercent}%`;
        document.getElementById(`${elementPrefix}ENPercent`).textContent = `${stats.enPercent}%`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
        if (elementPrefix === 'main') {
            document.getElementById('mainRUProgress').style.width = `${stats.ruPercent}%`;
            document.getElementById('mainRUPercentBar').textContent = `${stats.ruPercent}%`;
        } else if (elementPrefix === 'cn') {
            document.getElementById('cnRUProgress').style.width = `${stats.ruPercent}%`;
            document.getElementById('cnRUPercentBar').textContent = `${stats.ruPercent}%`;
        } else if (elementPrefix === 'unique') {
            document.getElementById('uniqueRUProgress').style.width = `${stats.ruPercent}%`;
            document.getElementById('uniqueRUPercentBar').textContent = `${stats.ruPercent}%`;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
    async function loadFile(url) {
        try {
            const res = await fetch(url);
            if (!res.ok) {
                throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${url}`);
            }
            const text = await res.text();
            return parseTSV(text);
        } catch (e) {
            console.error(e);
            throw e;
        }
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    async function loadAndProcess() {
        const loadingInfo = document.getElementById('loadingInfo');
        loadingInfo.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...';

        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–∞ —Ñ–∞–π–ª–∞
            loadingInfo.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ translation_ru.tsv...';
            const mainRows = await loadFile('../translation_ru.tsv');
            
            loadingInfo.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ cn_translate/translation_ru.tsv...';
            const cnRows = await loadFile('../cn_translate/translation_ru.tsv');

            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
            loadingInfo.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
            const mainStats = calculateStats(mainRows);
            updateStats('main', mainStats);

            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
            const cnStats = calculateStats(cnRows);
            updateStats('cn', cnStats);

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–∞—à–∏–Ω–Ω–æ–º—É RU
            // –†–∞–∑–Ω–∏—Ü–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ä—É—Å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –º–µ–∂–¥—É –º–∞—à–∏–Ω–Ω—ã–º –∏ –æ—Å–Ω–æ–≤–Ω—ã–º –ø–µ—Ä–µ–≤–æ–¥–æ–º
            const extraRu = Math.max(cnStats.ru - mainStats.ru, 0);
            // –î–æ–ª—è —Ä—É—Å—Å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ –º–∞—à–∏–Ω–Ω–æ–º –ø–µ—Ä–µ–≤–æ–¥–µ
            const ruShareInCn = cnStats.total > 0 ? ((cnStats.ru / cnStats.total) * 100).toFixed(1) : 0;
            // –ù–∞—Å–∫–æ–ª—å–∫–æ –º–∞—à–∏–Ω–Ω—ã–π RU –±–æ–ª—å—à–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ RU (–æ–∂–∏–¥–∞–µ–º–æ –±–æ–ª—å—à–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã)
            const ruRatio = mainStats.ru > 0 ? ((cnStats.ru / mainStats.ru) * 100).toFixed(1) : 0;

            document.getElementById('uniqueTotal').textContent = extraRu.toLocaleString();
            document.getElementById('uniqueRU').textContent = cnStats.ru.toLocaleString();
            document.getElementById('uniqueRUPercent').textContent = `${ruShareInCn}%`;
            document.getElementById('uniqueEN').textContent = mainStats.ru.toLocaleString();
            document.getElementById('uniqueENPercent').textContent = `${ruRatio}%`;
            document.getElementById('uniqueEmpty').textContent = `${ruRatio}%`;

            // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –±–ª–æ–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ª—é RU –≤ –º–∞—à–∏–Ω–Ω–æ–º –ø–µ—Ä–µ–≤–æ–¥–µ
            document.getElementById('uniqueRUProgress').style.width = `${ruShareInCn}%`;
            document.getElementById('uniqueRUPercentBar').textContent = `${ruShareInCn}%`;

            loadingInfo.textContent = `‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –û—Å–Ω–æ–≤–Ω–æ–π: ${mainStats.total.toLocaleString()} —Å—Ç—Ä–æ–∫, –ú–∞—à–∏–Ω–Ω—ã–π: ${cnStats.total.toLocaleString()} —Å—Ç—Ä–æ–∫, –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: ${uniqueStats.total.toLocaleString()} —Å—Ç—Ä–æ–∫`;
        } catch (e) {
            console.error(e);
            loadingInfo.textContent = `‚ùå –û—à–∏–±–∫–∞: ${e.message}`;
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    document.getElementById('btnRefresh').addEventListener('click', () => {
        loadAndProcess();
    });

    // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadAndProcess();
</script>
</body>
</html>

